{{/*
ImagePullSecret for ECR authentication.
ECR tokens expire after 12 hours. For automatic credential refresh in production,
use one of the following approaches:
  1. IAM Roles for Service Accounts (IRSA) with ECR access policy
  2. A CronJob that refreshes the ECR token periodically
  3. The amazon-ecr-credential-helper on each node

This template creates a docker-registry secret when imagePullSecrets values are provided.
*/}}
{{- range .Values.imagePullSecrets }}
{{- if .create }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .name }}
  labels:
    {{- include "persons-finder.labels" $ | nindent 4 }}
  annotations:
    description: "ECR image pull secret - refresh token before 12h expiry"
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ .dockerConfigJson | default "" | b64enc | quote }}
{{- end }}
{{- end }}
